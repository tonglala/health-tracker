<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健康管理 | Health Tracker</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <!-- Chart.js for beautiful charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css?v=3">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar Navigation (Desktop) -->
        <nav class="sidebar">
            <div class="logo">
                <h1>Healthy<span class="dot">.</span></h1>
            </div>

            <!-- User Profile / Login Section -->
            <div class="user-profile-section" id="auth-section">
                <button id="btn-login" class="btn-login">
                    <span class="material-icons-round">login</span> 登入 Google 同步資料
                </button>
                <div id="user-info" style="display: none;">
                    <img id="user-photo" src="" alt="User" class="user-photo">
                    <span id="user-name">User</span>
                    <button id="btn-logout" class="btn-icon-small" title="登出"><span
                            class="material-icons-round">logout</span></button>
                </div>
            </div>

            <ul class="nav-links">
                <li class="nav-item active" data-section="dashboard">
                    <span class="material-icons-round">dashboard</span>
                    <span>總覽</span>
                </li>
                <li class="nav-item" data-section="weight">
                    <span class="material-icons-round">monitor_weight</span>
                    <span>體重紀錄</span>
                </li>
                <li class="nav-item" data-section="food">
                    <span class="material-icons-round">restaurant_menu</span>
                    <span>飲食日記</span>
                </li>
                <li class="nav-item" data-section="settings">
                    <span class="material-icons-round">settings</span>
                    <span>個人設定</span>
                </li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- DASHBOARD SECTION -->
            <section id="dashboard" class="section active-section">
                <header class="top-bar">
                    <div>
                        <h2>總覽儀表板</h2>
                        <p class="subtitle" id="current-week-display">載入中...</p>
                    </div>
                    <div class="user-status-pill" id="bmi-status-pill">
                        BMI 正常
                    </div>
                </header>

                <div class="cards-grid">
                    <div class="card summary-card">
                        <div class="card-icon blue"><span class="material-icons-round">trending_up</span></div>
                        <div class="card-info">
                            <h3>總增重</h3>
                            <p class="big-number" id="total-gain-display">-- kg</p>
                            <small id="gain-advice">建議範圍 --</small>
                        </div>
                    </div>
                    <div class="card summary-card">
                        <div class="card-icon pink"><span class="material-icons-round">local_fire_department</span>
                        </div>
                        <div class="card-info">
                            <h3>今日熱量</h3>
                            <p class="big-number" id="today-calories-display">0</p>
                            <small>目標: <span id="target-calories">--</span> kcal</small>
                        </div>
                    </div>
                    <div class="card summary-card">
                        <div class="card-icon purple"><span class="material-icons-round">monitor_weight</span></div>
                        <div class="card-info">
                            <h3>目前體重</h3>
                            <p class="big-number" id="current-weight-display">--</p>
                            <small>上次測量: <span id="last-weigh-date">--</span></small>
                        </div>
                    </div>
                </div>

                <div class="chart-container card">
                    <div class="card-header">
                        <h3>體重趨勢圖 (IOM 標準)</h3>
                        <div class="chart-legend-custom">
                            <span class="dot home"></span> 家裡量 (參考)
                            <span class="dot clinic"></span> 診所量
                        </div>
                    </div>
                    <canvas id="weightChart"></canvas>
                    <div id="chart-analysis" class="analysis-box">
                        <!-- Dynamic analysis text will go here -->
                    </div>
                </div>
            </section>

            <!-- WEIGHT SECTION -->
            <section id="weight" class="section">
                <header class="top-bar">
                    <h2>體重紀錄</h2>
                </header>

                <div class="split-layout">
                    <div class="form-container card">
                        <h3>新增紀錄</h3>
                        <form id="weight-form">
                            <div class="form-group">
                                <label>測量日期</label>
                                <input type="date" id="weight-date" required>
                            </div>
                            <div class="form-group">
                                <label>體重 (kg)</label>
                                <input type="number" step="0.1" id="weight-value" placeholder="例如: 70.1" required>
                            </div>
                            <div class="form-group">
                                <label>測量情境</label>
                                <div class="toggle-group">
                                    <input type="radio" name="weight-type" id="type-home" value="home" checked>
                                    <label for="type-home" class="toggle-btn checked">
                                        <span class="material-icons-round">home</span> 家裡 (空腹/裸身)
                                    </label>

                                    <input type="radio" name="weight-type" id="type-clinic" value="clinic">
                                    <label for="type-clinic" class="toggle-btn">
                                        <span class="material-icons-round">local_hospital</span> 診所 (飯後/穿衣)
                                    </label>
                                </div>
                                <small class="hint">系統會區分兩者，避免因衣物造成誤判。</small>
                            </div>
                            <div class="form-group">
                                <label>備註 (選填)</label>
                                <input type="text" id="weight-note" placeholder="例如: 吃完大餐後...">
                            </div>
                            <button type="submit" class="btn-primary">儲存紀錄</button>
                        </form>
                    </div>

                    <div class="history-list card">
                        <h3>歷史紀錄</h3>
                        <ul id="weight-history-list" class="list-group">
                            <!-- Items injected by JS -->
                        </ul>
                    </div>
                </div>
            </section>

            <!-- FOOD SECTION -->
            <section id="food" class="section">
                <header class="top-bar">
                    <h2>飲食日記</h2>
                </header>

                <div class="split-layout">
                    <div class="form-container card">
                        <h3>新增飲食</h3>
                        <form id="food-form">
                            <div class="form-group">
                                <label>日期</label>
                                <input type="date" id="food-date" required>
                            </div>
                            <div class="form-group">
                                <label>餐別</label>
                                <select id="food-meal">
                                    <option value="breakfast">早餐</option>
                                    <option value="lunch">午餐</option>
                                    <option value="dinner">晚餐</option>
                                    <option value="snack">點心/宵夜</option>
                                </select>
                            </div>
                            <div class="form-group search-group">
                                <label>食物內容 (模糊描述)</label>
                                <div class="input-with-action">
                                    <input type="text" id="food-name" placeholder="例如: 半個排骨便當" required>
                                    <button type="button" class="btn-icon" id="btn-search-calories" title="上網查熱量">
                                        <span class="material-icons-round">search</span>
                                    </button>
                                </div>
                                <small class="hint">點擊放大鏡會幫你在 Google 搜尋熱量參考</small>
                            </div>
                            <div class="form-group">
                                <label>熱量 (kcal)</label>
                                <input type="number" id="food-calories" placeholder="輸入查詢後的數值" required>
                            </div>
                            <button type="submit" class="btn-primary">新增飲食</button>
                        </form>
                    </div>

                    <div class="history-list card">
                        <h3>今日飲食清單</h3>
                        <div class="daily-summary">
                            <span>今日總計: <strong id="food-list-total">0</strong> kcal</span>
                        </div>
                        <ul id="food-history-list" class="list-group">
                            <!-- Items injected by JS -->
                        </ul>
                    </div>
                </div>
            </section>

            <!-- SETTINGS SECTION -->
            <section id="settings" class="section">
                <header class="top-bar">
                    <h2>個人設定</h2>
                </header>
                <div class="card settings-card">
                    <form id="profile-form">
                        <h3>基本資料</h3>
                        <p class="text-muted">這些資料用於計算 BMI 與孕期建議增重曲線。</p>

                        <div class="form-grid">
                            <div class="form-group">
                                <label>身高 (cm)</label>
                                <input type="number" id="profile-height" value="165" required>
                            </div>
                            <div class="form-group">
                                <label>孕前體重 (kg)</label>
                                <input type="number" step="0.1" id="profile-start-weight" value="64" required>
                            </div>
                            <div class="form-group">
                                <label>最後一次月經 (LMP) 或 預產期</label>
                                <select id="date-method" onchange="toggleDateInput()">
                                    <option value="lmp">最後一次月經 (推算週數)</option>
                                    <option value="due">預產期 (倒推)</option>
                                </select>
                                <input type="date" id="profile-date-point" required>
                                <small class="hint" id="date-hint">若妳知道1/30滿20週，建議直接輸入該推算出的 LMP。</small>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-primary">儲存設定</button>
                            <button type="button" class="btn-danger" onclick="resetAllData()">重置所有資料</button>
                        </div>
                    </form>
                </div>
            </section>
        </main>

        <!-- Mobile Bottom Navigation -->
        <nav class="mobile-nav">
            <div class="nav-item active" data-section="dashboard">
                <span class="material-icons-round">dashboard</span>
                <span>總覽</span>
            </div>
            <div class="nav-item" data-section="weight">
                <span class="material-icons-round">monitor_weight</span>
                <span>體重</span>
            </div>
            <div class="nav-item" data-section="food">
                <span class="material-icons-round">restaurant_menu</span>
                <span>飲食</span>
            </div>
            <div class="nav-item" data-section="settings">
                <span class="material-icons-round">settings</span>
                <span>設定</span>
            </div>
        </nav>
    </div>
    <script type="module" src="app.js?v=4"></script>
</body>

</html>